<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
      <title>Plotly Test</title>
      <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon">

      <!-- This is a development version of Vue.js! -->
      <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.3.2/math.js" type="text/javascript"></script>
      <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async
              src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
      </script>

      <!-- import stylesheet -->
      <link rel="stylesheet" href="./main.css">
      <!-- Google fonts -->
      <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

      <!-- import es6 module in main.js -->
      <script src="./components/plotly/plotly.js" type="module"></script>
      <script src="./components/index.js" type="module"></script>
    </head>
  <body>
    <!-- Components -->
    <div id="app">
      <div>
        <section class="section-container" :class="{ 'section-container_hide': !isVisibleMenu }">
          <div class="section__btn_close" v-on:click="isVisibleMenu = !isVisibleMenu">
            <div class="p-icon p-icon-chevron-left" :class="{ 'section__btn_close_rotate': isVisibleMenu }"></div>
          </div>

          <div class="section-container__block">
            <div class="section-container__actions">
              <div class="section__btn" v-bind:class="{ 'section__btn_active': action === 'create' }" v-on:click="action = 'create'">
                Создание
              </div>
              <div class="section__btn" v-bind:class="{ 'section__btn_active': action === 'edit' }" v-on:click="action = 'edit'">
                Редактирование
              </div>
            </div>
            <div class="section-container__content" v-if="action === 'create'">
              <create-graph v-on:create="onCreate" />
            </div>
            <div class="section-container__content" v-else-if="action === 'edit' && graphs.length">
              <update-graph v-on:update="onUpdate" v-bind:graphs="graphs"/>
            </div>
          </div>
        </section>

        <div class="container">
          <div v-if="normalizedGraphs.length === 0" style="padding-top: 100px;">
            <p>- Пока нет графиков на полотне...</p>
            <p v-on:click="isVisibleMenu = true;">-&nbsp;<b class="p-link">Создать?</b></p>
          </div>

          <div v-else v-for="(grapg, index) in normalizedGraphs" :key="index">
            <div class="plotly">
              <div class="plotly__actions">
                <div class="btn btn_outline ml-2" v-on:click="removeGraph(index)">
                  <div class="p-icon p-icon-close"></div>
                </div>
                
                <div class="btn btn_outline ml-2" v-on:click="removePoint(index, valueIndex)">
                  <div class="p-icon p-icon-edit"></div>
                </div>
              </div>
              
              <plotly 
                v-bind:data="grapg.data" 
                v-bind:layout="grapg.layout" 
                v-bind:display-mode-bar="true" 
                v-on:relayout="recount($event, index)"
                v-bind:scroll-zoom="true"
                v-bind:mode-bar-buttons-to-remove="['lasso2d','zoom2d','resetScale2d','toggleSpikelines','producedWithPlotly']"
              ></plotly>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
